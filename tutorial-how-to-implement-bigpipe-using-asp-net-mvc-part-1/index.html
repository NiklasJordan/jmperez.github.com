<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta http-equiv=Accept-CH content="DPR, Viewport-Width, Width"><title>Tutorial: Implementing Facebook's BigPipe Using ASP.Net MVC - Part 1 - José M. Pérez</title><meta name=description content="First part of the tutorial to implement Facebook's BigPipe using ASP.Net MVC. BigPipe improves pages loading time dividing them into regions that are generated on the server concurrently."><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><link rel=author href="https://plus.google.com/107456024651797783420"/><link rel=alternate type=application/rss+xml title="Jose M. Perez" href=https://jmperezperez.com/feed.xml><meta name=twitter:card content=summary><meta name=twitter:url content="https://jmperezperez.com/tutorial-how-to-implement-bigpipe-using-asp-net-mvc-part-1/" property=og:url><meta name=twitter:title content="Tutorial: Implementing Facebook's BigPipe Using ASP.Net MVC - Part 1 - José M. Pérez" property=og:title><meta name=twitter:description content="First part of the tutorial to implement Facebook's BigPipe using ASP.Net MVC. BigPipe improves pages loading time dividing them into regions that are generated on the server concurrently." property=og:description><meta name=twitter:site content=@jmperezperez><meta property=og:image content=https://res.cloudinary.com/jmperez/image/upload/f_auto,c_scale/v1519156883/profile_ysrm5y.jpg><meta name=twitter:image content=https://res.cloudinary.com/jmperez/image/upload/f_auto,c_scale/v1519156883/profile_ysrm5y.jpg><meta property=fb:app_id content=1702266270006013><meta property=fb:pages content="1639848659664211"/><link rel=canonical href="https://jmperezperez.com/tutorial-how-to-implement-bigpipe-using-asp-net-mvc-part-1/"/><style>*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;border:none;font:inherit;margin:0;padding:0;vertical-align:baseline}button,input{background:0 0}body{background:#fff;color:#555;font-family:Georgia,Times;font-weight:300;font-style:normal;font-size:19px;line-height:1.725;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%}@media(max-width:800px){body{font-size:17px}}@media(max-width:600px){body{font-size:15px}}h1,h2,h3,h4,h5{color:#212121;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:600;font-size:1em;line-height:1.3;margin-bottom:1em}h2,h3,h4,h5{margin-top:2em}#menu a,.button{font-size:1em;font-weight:400}.post ol,.post ul,amp-video,amp-vimeo,amp-youtube,iframe,p,video{margin:0;margin-bottom:1em}twitterwidget{margin-bottom:1em!important}a{color:#2a7cb2;font-weight:inherit;text-decoration:none;transition:color .15s ease-out,border-bottom-color .15s ease-out}a:hover{color:#2a7cb2}p a{border-bottom:1px solid #eee}p a:hover{border-bottom-color:#212121}strong{font-weight:700}em{font-style:italic}h1{font-size:1.7em}h2{color:#444;font-size:1.6em;font-weight:400}h3{color:#666;font-size:1.4em;font-weight:400}h4{font-size:1.18em}h5{font-size:1em}a h1,a h2,a h3,a h4,a h5{transition:color .15s ease-out}a:hover h1,a:hover h2,a:hover h3,a:hover h4,a:hover h5{color:#3498db}.quote{margin:0 0 15px 0}blockquote{border-left:2px solid #ccc;font-style:italic;margin:0 0 15px 0;padding-left:20px}ol,ul{margin:0 0 15px 0;padding-left:25px}ul{list-style:square}ol{list-style:decimal}hr{background:#eee;color:#eee;clear:both;display:block;height:2px;margin:30px auto;width:50%}code,pre{color:#333;font-family:Courier,Menlo,Monaco;font-size:.8em;letter-spacing:0;overflow-x:auto}pre{padding:.8em 1em;white-space:pre-wrap}code{margin:0}.post::after{display:block;clear:both;content:''}.main-header{background-color:#005689;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;overflow:hidden;padding:1em;position:relative;text-align:center;width:100%}#menu{display:inline-block;margin:1px 0}#menu a{color:#fff;font-size:14px;margin-left:15px;padding:20px 10px;text-transform:uppercase}@media(max-width:500px){#menu a{margin-left:10px;padding:10px 5px}}#menu a:first-child{margin-left:0}#menu a[aria-current]{font-weight:700}#page{margin:0 auto;max-width:40em;padding:3em 2em;position:relative}.videoWrapper{height:0;margin-bottom:1em;padding-bottom:56.25%;padding-top:25px;position:relative}.videoWrapper amp-youtube,.videoWrapper iframe{height:100%;left:0;position:absolute;top:0;width:100%}.wrapper{border-top:2px solid #eee;padding:3em 0}.wrapper:first-child{border-top:none;padding-top:5%}.posts-list h2{margin-top:0}.post{display:block;width:100%}.post div[itemprop=articleBody]>p:first-child{color:#333}.post li{margin-bottom:.5em}.post p img{border:1px solid #eee;display:block;max-width:100%}.post img+.caption{padding-top:5px}.post .svg-container{margin-bottom:5%;max-width:100%;text-align:center}video{height:auto;max-width:100%}.post .svg-container object{width:100%}.tag-list{list-style-type:none;margin:0;padding:0}.tag-list-item{display:inline-block;margin-right:1em}.pagination{text-align:center}.pagination a{min-width:30px;max-height:30px;text-align:center}footer{border-top:1px dashed #ddd;padding:2em;text-align:center}.timing-stats{font-size:.7em;padding:.35em}.button{background-color:#fff;border:1px solid #555;border-radius:20px;color:#555;display:inline-block;font-size:13px;line-height:10px;padding:10px 20px;transition:background-color .15s ease-out}.button:hover{background-color:#3498db;border-color:transparent;color:#fff}.button.inactive{background-color:#ccc;color:#fff}.search-goog input{border:2px solid #ddd;padding:10px}.search-goog input[type=submit]{background-color:#ddd;cursor:pointer}@media only screen and (max-width:768px){#page,.wrapper{margin:0;max-width:100%;padding:1.5em;width:100%}.wrapper{padding:10% 0}.wraper::after{clear:both;content:'';display:block}.post{margin:0 auto;max-width:640px}}.outscreen{height:1px;left:-1000px;overflow:hidden;position:absolute;top:auto;width:1px}.callout{border:1px solid #eee;border-left-color:#777;border-left-width:5px;border-radius:3px;font-size:90%;padding:20px;margin:20px 0}.author{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:.8em;margin-bottom:2em}.author .name{line-height:1.5;padding-top:.35em}.bd,.media{overflow:hidden;zoom:1}.media .img{float:left}.avatar-img{border-radius:100%;height:3.5em;margin-right:.5em;width:3.5em}code[class*=language-],pre[class*=language-]{color:#393a34;font-family:Consolas,"Bitstream Vera Sans Mono","Courier New",Courier,monospace;direction:ltr;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;font-size:.85em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border:1px solid #ddd;background-color:#fff}:not(pre)>code[class*=language-]{padding:.2em;padding-top:1px;padding-bottom:1px;background:#f8f8f8;border:1px solid #ddd}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#998;font-style:italic}.token.namespace{opacity:.7}.token.attr-value,.token.string{color:#e3116c}.token.operator,.token.punctuation{color:#393a34}.token.boolean,.token.constant,.token.entity,.token.inserted,.token.number,.token.property,.token.regex,.token.symbol,.token.url,.token.variable{color:#005cc5}.token.keyword{color:#d73a49}.token.atrule,.token.attr-name{color:#6f42c1}.token.deleted,.token.function{color:#6f42c1}.token.selector{color:#00009f}.token.tag{color:#22863a}.token.class-name{color:#6f42c1}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.code-wrap pre{white-space:pre-wrap}.caption{display:block;font-size:.8em;text-align:center}.codepen-aspect-ratio>iframe{height:100%;position:absolute;width:100%}.twitter-tweet{margin-left:auto;margin-right:auto}.twitter-tweet::after{content:"";display:block;padding-bottom:20px;width:100%}.me{max-width:20em;margin:0 auto .5em;text-align:center}.me h1{margin-bottom:0}</style><link rel=amphtml href="/tutorial-how-to-implement-bigpipe-using-asp-net-mvc-part-1/amp/"><meta name=theme-color content=#005689><link rel=manifest href=/manifest.json></head><body><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-39254352-1","auto"),ga("send","pageview");</script><header class=main-header><nav id=menu><a href="/">Blog</a> <a href="/projects/">Projects</a> <a href="/talks/">Speaking</a> <a href="/about-me/">About</a></nav></header><div id=page><article class=wrapper><div class=post><header><script type=application/ld+json>{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Tutorial: Implementing Facebook's BigPipe Using ASP.Net MVC - Part 1",
  
  "description": "First part of the tutorial to implement Facebook's BigPipe using ASP.Net MVC. BigPipe improves pages loading time dividing them into regions that are generated on the server concurrently.",
  
  "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://jmperezperez.com/tutorial-how-to-implement-bigpipe-using-asp-net-mvc-part-1/"
  },
  "datePublished": "2010-09-18T07:37:07.000Z",
  "dateModified": "2018-01-04T11:39:58.000Z",
  
  "author": {
      "@type": "Person",
      "name": "Jose M. Perez",
      "url": "https://jmperezperez.com",
      "sameAs": [
        "http://www.linkedin.com/in/jmperezperez",
        "https://twitter.com/jmperezperez"
      ]
  },
  "publisher": {
      "@type": "Organization",
      "name": "Jose M. Perez's Blog"
      
      ,
      "logo": {
        "@type": "ImageObject",
        "url": "https://jmperezperez.com/assets/images/logo.png",
        "width": 600,
        "height": 60
      }
      
  }
}</script><div class="media author"><div class=img><a href="/about-me/"><img src=https://res.cloudinary.com/jmperez/image/upload/w_120,f_auto,c_scale/v1519156883/profile_ysrm5y.jpg class=avatar-img alt="" height=53 width=53 sizes=53px></a></div><div class=bd><address class=name itemprop=author itemscope itemtype=https://schema.org/Person><a href="/about-me/" itemprop=name>José M. Pérez</a></address><meta class=post-data itemprop=datePublished content=2010-09-18T07:37:07.000Z>September 18 2010</div></div><h1>Tutorial: Implementing Facebook's BigPipe Using ASP.Net MVC - Part 1</h1></header><p>Parts of the tutorial</p><ol><li>Introduction to BigPipe</li><li><a href=/tutorial-how-to-implement-bigpipe-using-asp-net-mvc-part-2>How ASP.Net MVC fits in the model. Registering and generating pagelets</a></li><li><a href=/tutorial-how-to-implement-bigpipe-using-asp-net-mvc-part-3>Browser implementation of BigPipe. Loading pagelets and their resources effectively</a></li><li><a href=https://github.com/JMPerez/BigPipe target=_blank rel=noopener>Check out the demo Visual Studio solution</a></li></ol><p>Through a series of posts I will explain how we can implement BigPipe Facebook using ASP.Net MVC.</p><a id=more></a><p>In this first post I will describe what BigPipe is and sketch how we can make a similar implementation using ASP.Net MVC.</p><p>You can clone the code from <a href=https://github.com/JMPerez/BigPipe target=_blank rel=noopener>the BigPipe project on GitHub</a> that includes all the source code needed to run the sample.</p><h2 id=What-is-BigPipe><a href=#What-is-BigPipe class=headerlink title="What is BigPipe"></a>What is BigPipe</h2><p>BigPipe is a <a href=/techniques-optimize-web-sites>website performance technique</a> used and coined by Facebook to serve web pages improving user’s perceived load speed. In general, it consists of serving quickly the main content of the page, and then serve the content from other regions of the page called pagelets.</p><p>The implementation of these pagelets is performed in parallel on the server and served to the browser as soon as they are generated. This allows:</p><ol><li>Browser can start rendering the page content earlier (early flushing)</li><li>Pagelets are served as soon as they are ready and the browser can render them in their container.</li><li>If one pagelet takes longer to run, it will not delay the generation of the rest of pagelets.</li><li>Pagelets are generated in several concurrent asynchronous threads and when a thread finishes its execution, it flushes the content so the browser can start rendering.</li></ol><p>Sequence of the different stages during a pagelet generation:</p><p><img src=/assets/images/posts/bigpipe-sequence.svg alt="Sequence of the different stages during a pagelet generation"></p><p>Apart from the pagelet generation, parallelism is also applied during the processing of the pagelet by the browser. Each pagelet can define a set of CSS and JS files that it needs to work properly. These files are requested in such a way that it keeps a good performance.</p><p>Graph showing how pagelets resources are requested:</p><p><img src=/assets/images/posts/bigpipe-pagelet-process.svg alt="Graph showing how pagelets resources are requested"></p><ol><li>For each pagelet, request in parallel every necessary CSS resource</li><li>Once a pagelet has the necessary CSS files, inject the HTML code inside its container.</li><li>When every pagelet has finished request its CSS files and is inserted in the document, proceed to request in parallel the JS files needed by the whole set of pagelets.</li></ol><p>By keeping these steps we make sure that the pagelets are appended to the document and set their style, avoiding a FUOC (Flash Of Unstyled Content). By delaying the download of JS resources we are prioritizing CSS requests for content be shown earlier, as well as other pagelets to be downloaded.</p><h3 id=Requirements><a href=#Requirements class=headerlink title=Requirements></a>Requirements</h3><p>Your browser must support Javascript, since the content is embedded using Javascript. Our implementation takes into account progressive enhancement to serve pages not using BigPipe for browsers without Javascript or search engine bots (keeping SEO and accessibility).</p><h3 id=Benefits><a href=#Benefits class=headerlink title=Benefits></a>Benefits</h3><ul><li>Load time perceived by the user is better. Rendering earlier the main content of the page, browser starts making requests for resources CSS and Javascript earluer, as well as inerpreting the DOM tree.</li><li>We take advantage of the parallelism in the server side, running simultaneously multiple pagelets.</li><li>In general, improving the parallelism of the system. As the browser renders a region, some others are being transmitted through the wire and some other being built in the server.</li><li>Everything is done in a single request by the client. You could implement BigPipe using Ajax calls from the browser to generate the pagelets, but at the expense of a greater number of requests (this will be covered in another post).</li></ul><h3 id=Disadvantages><a href=#Disadvantages class=headerlink title=Disadvantages></a>Disadvantages</h3><ul><li>When you flush each pagelet more packets are sent from server to client (however we can always decide to send more than one pagelet in each flushing).</li><li>Browser has to interpret the code and insert pagelets in their containers. This causes repaintings and reflows which can be annoying to the user.</li></ul><p><a href=/tutorial-how-to-implement-bigpipe-using-asp-net-mvc-part-2>In part 2 of the tutorial</a> I explain how to use ASP.Net MVC to implement BigPipe, using RenderActions and threads pool to execute the pagelets.</p><h4 id=Other-resources><a href=#Other-resources class=headerlink title="Other resources"></a>Other resources</h4><p>Some other people have implemented the basics of this technique using Java (<a href=http://www.olympum.com/java/facebook-bigpipe-in-an-async-servlet target=_blank rel=noopener>Bruno Fernandez-Ruiz</a> and <a href="http://codemonkeyism.com/facebook-bigpipe-java/" target=_blank rel=noopener>Stephan Schmidt</a>) and using Node.js (<a href=http://www.subbu.org/blog/2010/07/bigpipe-done-in-node-js target=_blank rel=noopener>Subbu Allamaraju</a>).</p></div><hr/>Tags:<ul class=tag-list><li class=tag-list-item><a class=tag-list-link href="/tags/bigpipe/">bigpipe</a></li><li class=tag-list-item><a class=tag-list-link href="/tags/facebook/">facebook</a></li><li class=tag-list-item><a class=tag-list-link href="/tags/flush/">flush</a></li><li class=tag-list-item><a class=tag-list-link href="/tags/optimization/">optimization</a></li><li class=tag-list-item><a class=tag-list-link href="/tags/performance/">performance</a></li></ul></article></div><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(n){})["catch"](function(n){})});</script><footer><section class=links><a href=https://twitter.com/jmperezperez>@jmperezperez</a> on Twitter · <a href=https://github.com/JMPerez>GitHub</a> · <a href=http://www.linkedin.com/in/jmperezperez>LinkedIn</a></section><div class=timing-stats></div></footer><script>window.addEventListener('load', () => {
     setTimeout(() => {
      var t = window.performance && performance.timing;
      function round2(num) { return Math.round(num * 100) / 100; }
      if (t) {
          var timingStats = document.querySelector('.timing-stats');
          var loadTime = (t.loadEventEnd - t.navigationStart) / 1000;
          var timingStatsHTML = 'This page loaded in ' + round2(loadTime) + ' seconds. ';
          var performanceEntries = performance.getEntriesByType('paint');
          performanceEntries.forEach(function(performanceEntry, i, entries) {
            var name = performanceEntry.name;
            if (name === 'first-paint') {
              name = '<abbr title=' + name + '>FP</abbr>';
            } else if (name === 'first-contentful-paint') {
              name = '<abbr title=' + name + '>FCP</abbr>';
            }
            timingStatsHTML += name + ' was ' + round2(performanceEntry.startTime / 1000) + ' seconds. ';
          });
          timingStats.innerHTML = timingStatsHTML;
      }
    }, 0);
   });</script></body></html>