<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta http-equiv=Accept-CH content="DPR, Viewport-Width, Width"><title>Google Maps Geolocation and Directions to a Specific Destination - JMPerez Blog</title><meta name=description content="Have you ever wondered how to show a google map showing instructions on how to get to your business? You can do it easily detecting your visitor's position and then provide directions to get to a specific destination."><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><link rel=author href="https://plus.google.com/107456024651797783420"/><link rel=alternate type=application/rss+xml title="Jose M. Perez" href=https://jmperezperez.com/feed.xml><meta name=twitter:card content=summary><meta name=twitter:url content="https://jmperezperez.com/google-maps-geolocation-directions-specific-destination/" property=og:url><meta name=twitter:title content="Google Maps Geolocation and Directions to a Specific Destination" property=og:title><meta name=twitter:description content="Have you ever wondered how to show a google map showing instructions on how to get to your business? You can do it easily detecting your visitor's position and then provide directions to get to a specific destination." property=og:description><meta name=twitter:site content=@jmperezperez><meta property=fb:app_id content=1702266270006013><meta property=fb:pages content="1639848659664211"/><link rel=canonical href="https://jmperezperez.com/google-maps-geolocation-directions-specific-destination/"/><style>a,a:hover{color:#2a7cb2}.post::after,hr{display:block;clear:both}#page,.main-header,.videoWrapper{position:relative}.code,code,pre{letter-spacing:0}.code-wrap pre,pre{white-space:pre-wrap}.caption,.main-header,.me,.pagination,.pagination a,footer{text-align:center}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;border:none;font:inherit;margin:0;padding:0;vertical-align:baseline}button,input{background:0 0}body{background:#fff;color:#555;font-family:Georgia,Times;font-weight:300;font-style:normal;font-size:19px;line-height:1.725;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%}blockquote,em{font-style:italic}@media(max-width:800px){body{font-size:17px}}@media(max-width:600px){body{font-size:15px}}h1,h2,h3,h4,h5{color:#212121;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:600;font-size:1em;line-height:1.3;margin-bottom:1em}h2,h3,h4,h5{margin-top:2em}#menu a,.button{font-weight:400}.post ol,.post ul,amp-video,amp-vimeo,amp-youtube,iframe,p,video{margin:0 0 1em}.quote,blockquote,ol,ul{margin:0 0 15px}twitterwidget{margin-bottom:1em!important}a{font-weight:inherit;text-decoration:none;transition:color .15s ease-out,border-bottom-color .15s ease-out}p a{border-bottom:1px solid #eee}p a:hover{border-bottom-color:#212121}strong{font-weight:700}h2,h3{font-weight:400}h1{font-size:1.7em}h2{color:#444;font-size:1.6em}h3{color:#666;font-size:1.4em}h4{font-size:1.18em}h5{font-size:1em}a h1,a h2,a h3,a h4,a h5{transition:color .15s ease-out}a:hover h1,a:hover h2,a:hover h3,a:hover h4,a:hover h5{color:#3498db}blockquote{border-left:2px solid #ccc;padding-left:20px}ol,ul{padding-left:25px}ul{list-style:square}ol{list-style:decimal}hr{background:#eee;color:#eee;height:2px;margin:30px auto;width:50%}.main-header,.post,.post .svg-container object{width:100%}code,pre{color:#333;font-family:Courier,Menlo,Monaco;font-size:.8em;overflow-x:auto}.author,.main-header{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif}pre{padding:.8em 1em}code{margin:0}.post::after{content:''}.main-header{background-color:#005689;overflow:hidden;padding:1em}#menu{display:inline-block;margin:1px 0}#menu a{color:#fff;font-size:14px;margin-left:15px;padding:20px 10px;text-transform:uppercase}@media(max-width:500px){#menu a{margin-left:10px;padding:10px 5px}}#menu a:first-child{margin-left:0}#menu a[aria-current]{font-weight:700}#page{margin:0 auto;max-width:40em;padding:3em 2em}.videoWrapper{height:0;margin-bottom:1em;padding-bottom:56.25%;padding-top:25px}.videoWrapper amp-youtube,.videoWrapper iframe{height:100%;left:0;position:absolute;top:0;width:100%}.wrapper{border-top:2px solid #eee;padding:3em 0}.wrapper:first-child{border-top:none;padding-top:5%}.posts-list h2{margin-top:0}.post{display:block}.post div[itemprop=articleBody]>p:first-child{color:#333}.post li{margin-bottom:.5em}.post p img{border:1px solid #eee;display:block;max-width:100%}.post img+.caption{padding-top:5px}.post .svg-container{margin-bottom:5%;max-width:100%;text-align:center}video{height:auto;max-width:100%}.pagination a{min-width:30px;max-height:30px}footer{background:rgba(0,0,0,.05);padding:2em}.button{background-color:#fff;border:1px solid #555;border-radius:20px;color:#555;display:inline-block;font-size:13px;line-height:10px;padding:10px 20px;transition:background-color .15s ease-out}.button:hover{background-color:#3498db;border-color:transparent;color:#fff}.button.inactive{background-color:#ccc;color:#fff}.search-goog input{border:2px solid #ddd;padding:10px}.search-goog input[type=submit]{background-color:#ddd;cursor:pointer}@media only screen and (max-width:768px){#page,.wrapper{margin:0;max-width:100%;padding:1.5em;width:100%}.wrapper{padding:10% 0}.wraper::after{clear:both;content:'';display:block}.post{margin:0 auto;max-width:640px}}.outscreen{height:1px;left:-1000px;overflow:hidden;position:absolute;top:auto;width:1px}.callout{border:1px solid #eee;border-left-color:#777;border-left-width:5px;border-radius:3px;font-size:90%;padding:20px;margin:20px 0}.author{font-size:.8em;margin-bottom:2em}.author .name{line-height:1.5;padding-top:.35em}.bd,.media{overflow:hidden;zoom:1}.media .img{float:left}.avatar-img{border-radius:100%;height:3.5em;margin-right:.5em;width:3.5em}.highlight{border:1px solid #eee;margin-bottom:1em;overflow-x:auto}.code{background:#fff;color:#333;display:block;overflow-x:auto}.code .comment,.code .meta{color:#969896}.code .emphasis,.code .quote,.code .string,.code .strong,.code .template-variable,.code .variable{color:#df5000}.code .keyword,.code .selector-tag,.code .type{color:#a71d5d}.code .attribute,.code .bullet,.code .literal,.code .symbol{color:#0086b3}.code .name,.code .section{color:#63a35c}.code .tag{color:#333}.code .attr,.code .selector-attr,.code .selector-class,.code .selector-id,.code .selector-pseudo,.code .title{color:#795da3}.code .addition{background-color:#eaffea;color:#55a532}.code .deletion{background-color:#ffecec;color:#bd2c00}.code .link{text-decoration:underline}.caption{display:block;font-size:.8em}.codepen-aspect-ratio>iframe{height:100%;position:absolute;width:100%}.twitter-tweet{margin-left:auto;margin-right:auto}.twitter-tweet::after{content:"";display:block;padding-bottom:20px;width:100%}.me{max-width:20em;margin:0 auto .5em}.me h1{margin-bottom:0}</style><link rel=amphtml href="/google-maps-geolocation-directions-specific-destination/amp/"><meta name=theme-color content=#005689><link rel=manifest href=/manifest.json></head><body><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-39254352-1","auto"),ga("send","pageview");</script><header class=main-header><nav id=menu><a href="/">Blog</a> <a href="/projects/">Projects</a> <a href="/talks/">Speaking</a> <a href="/about-me/">About</a></nav></header><div id=page><article class=wrapper><div class=post><header><script type=application/ld+json>{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Google Maps Geolocation and Directions to a Specific Destination",
  
  "description": "Have you ever wondered how to show a google map showing instructions on how to get to your business? You can do it easily detecting your visitor's position and then provide directions to get to a specific destination.",
  
  "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://jmperezperez.com/google-maps-geolocation-directions-specific-destination/"
  },
  "datePublished": "2010-07-16T16:50:57.000Z",
  "dateModified": "2018-01-04T11:39:58.000Z",
  
  "author": {
      "@type": "Person",
      "name": "Jose M. Perez"
  },
  "publisher": {
      "@type": "Organization",
      "name": "Jose M. Perez's Blog"
      
      ,
      "logo": {
        "@type": "ImageObject",
        "url": "https://jmperezperez.com/assets/images/logo.png",
        "width": 600,
        "height": 60
      }
      
  }
}</script><div class="media author"><div class=img><a href="/about-me/"><img src=https://res.cloudinary.com/jmperez/image/upload/w_120,f_auto,c_scale/v1519156883/profile_ysrm5y.jpg class=avatar-img alt="" height=53 width=53 sizes=53px></a></div><div class=bd><address class=name itemprop=author itemscope itemtype=https://schema.org/Person><a href="/about-me/" itemprop=name>José M. Pérez</a></address><meta class=post-data itemprop=datePublished content=2010-07-16T16:50:57.000Z>July 16 2010</div></div><h1>Google Maps Geolocation and Directions to a Specific Destination</h1></header><p>While helping in the redesign of Signum’s website I took a look at Google Maps. It’s been almost 2 years since I last used the API for my end career project.</p><p>Now I wanted to know if I could make use of geolocalization and directions to show a visitor the way to get to our headquarters from wherever he/she is, instead of just showing with a marker where we are. Thanks to geolocation we can find out with precision the position coordinates of the visitor. <a href=/assets/images/posts/google-maps-geolocation-directions.jpg><img src=/assets/images/posts/google-maps-geolocation-directions-300x187.jpg alt="Geolocation to guide visitor&#39;s to a specific place"></a> <a href=/demos/geoposition>View demo</a></p><a id=more></a><p>The code makes use of HTML5 and Google geolocation services, as well as the new Google Maps API v3.</p><p>Some time ago I would have done this (in fact in the project I did this way) querying an IP address to Location database to get the position, having to update data almost every month, as IP addresses were reassigned.</p><p>Now you can get it done by using HTML5 geolocation feature primarily an then use an alternative service as a fallback in case the browser does not support HTML5 or it throws an error when getting the location.</p><p>Here is the JS code (also as <a href=https://gist.github.com/4587682 target=_blank rel=noopener>a Gist on Github</a>). To see a complete working sample <a href=/demos/geoposition>visit the demo</a>:</p><figure class="highlight js"><table><tr><td class=code><pre><span class=line>(<span class=function><span class=keyword>function</span>(<span class=params></span>) </span>&#123;</span><br><span class=line><span class=meta>  'use strict'</span>;</span><br><span class=line>  <span class=keyword>var</span> map, <span class=comment>//the google map</span></span><br><span class=line>  directionsService, <span class=comment>//service that provides directions to reach our destination</span></span><br><span class=line>  directionsDisplay, <span class=comment>//renderer that draws directions on map</span></span><br><span class=line>  destinationName = <span class=string>'Ventorro del Cano, Madrid'</span>; <span class=comment>//our destination. Set yours!</span></span><br><span class=line></span><br><span class=line>  <span class=comment>// providers</span></span><br><span class=line>  <span class=keyword>var</span> html5Provider = <span class=function><span class=keyword>function</span>(<span class=params></span>) </span>&#123;</span><br><span class=line>    <span class=keyword>return</span> &#123;</span><br><span class=line>      <span class=string>'type'</span>: <span class=string>'HTML5'</span>,</span><br><span class=line>      <span class=string>'getPosition'</span>: <span class=function><span class=keyword>function</span>(<span class=params>onSuccess, onError</span>) </span>&#123;</span><br><span class=line>        <span class=keyword>if</span> (navigator.geolocation) &#123;</span><br><span class=line>          navigator.geolocation.getCurrentPosition(<span class=function><span class=keyword>function</span>(<span class=params>position</span>) </span>&#123;</span><br><span class=line>            onSuccess(&#123;</span><br><span class=line>              <span class=string>'lat'</span>: position.coords.latitude,</span><br><span class=line>              <span class=string>'lng'</span>: position.coords.longitude</span><br><span class=line>            &#125;);</span><br><span class=line>          &#125;, <span class=function><span class=keyword>function</span>(<span class=params>error</span>) </span>&#123;</span><br><span class=line>            <span class=keyword>switch</span> (error.code) &#123;</span><br><span class=line>              <span class=keyword>case</span> error.TIMEOUT:</span><br><span class=line>                onError(<span class=string>'Timeout'</span>);</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>              <span class=keyword>case</span> error.POSITION_UNAVAILABLE:</span><br><span class=line>                onError(<span class=string>'Position unavailable'</span>);</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>              <span class=keyword>case</span> error.PERMISSION_DENIED:</span><br><span class=line>                onError(<span class=string>'Permission denied'</span>);</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>              <span class=keyword>case</span> error.UNKNOWN_ERROR:</span><br><span class=line>                onError(<span class=string>'Unknown error'</span>);</span><br><span class=line>                <span class=keyword>break</span>;</span><br><span class=line>            &#125;</span><br><span class=line>          &#125;);</span><br><span class=line>        &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>          onError(<span class=string>'HTML5 navigator is not supported'</span>);</span><br><span class=line>        &#125;</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;;</span><br><span class=line>  &#125;;</span><br><span class=line></span><br><span class=line>  <span class=comment>// have a look at this StackOverflow thread, since it seems Google Geocoder is no longer active</span></span><br><span class=line>  <span class=comment>// http://stackoverflow.com/questions/14195837/is-google-loader-clientlocation-still-supported</span></span><br><span class=line>  <span class=keyword>var</span> googleGeocoderProvider = <span class=function><span class=keyword>function</span>(<span class=params></span>) </span>&#123;</span><br><span class=line>    <span class=keyword>return</span> &#123;</span><br><span class=line>      <span class=string>'type'</span>: <span class=string>'Google Geocoder'</span>,</span><br><span class=line>      <span class=string>'getPosition'</span>: <span class=function><span class=keyword>function</span>(<span class=params>onSuccess, onError</span>) </span>&#123;</span><br><span class=line>        <span class=keyword>if</span> (<span class=keyword>typeof</span> google === <span class=string>'object'</span>) &#123;</span><br><span class=line>          <span class=keyword>var</span> location = google.loader.ClientLocation;</span><br><span class=line>          <span class=keyword>if</span> (location) &#123;</span><br><span class=line>            onSuccess(&#123;</span><br><span class=line>              <span class=string>'lat'</span>: location.latitude,</span><br><span class=line>              <span class=string>'lng'</span>: location.longitude</span><br><span class=line>            &#125;);</span><br><span class=line>          &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>            onError(<span class=string>'Google Geocoder was unable to get the client position'</span>);</span><br><span class=line>          &#125;</span><br><span class=line>        &#125;</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;;</span><br><span class=line>  &#125;;</span><br><span class=line></span><br><span class=line>  <span class=comment>// register providers</span></span><br><span class=line>  <span class=keyword>var</span> providers = [html5Provider, googleGeocoderProvider];</span><br><span class=line></span><br><span class=line>  <span class=function><span class=keyword>function</span> <span class=title>init</span>(<span class=params></span>) </span>&#123;</span><br><span class=line>    <span class=keyword>var</span> i = <span class=number>0</span>;</span><br><span class=line></span><br><span class=line>    <span class=function><span class=keyword>function</span> <span class=title>testProvider</span>(<span class=params>i</span>) </span>&#123;</span><br><span class=line>      <span class=keyword>var</span> provider = providers[i]();</span><br><span class=line>      provider.getPosition(<span class=function><span class=keyword>function</span>(<span class=params>position</span>) </span>&#123;</span><br><span class=line>        showMapAndRoute(provider.type, position);</span><br><span class=line>      &#125;, <span class=function><span class=keyword>function</span>(<span class=params>error</span>) </span>&#123;</span><br><span class=line>        <span class=built_in>console</span>.error(error);</span><br><span class=line>        i++;</span><br><span class=line>        <span class=keyword>if</span> (i &amp;lt; providers.length) &#123;</span><br><span class=line>          testProvider(i);</span><br><span class=line>        &#125;</span><br><span class=line>      &#125;);</span><br><span class=line>    &#125;</span><br><span class=line></span><br><span class=line>    testProvider(i);</span><br><span class=line>  &#125;</span><br><span class=line></span><br><span class=line>  <span class=function><span class=keyword>function</span> <span class=title>showMapAndRoute</span>(<span class=params>method, coordinates</span>) </span>&#123;</span><br><span class=line>    <span class=built_in>document</span>.getElementById(<span class=string>'method'</span>).innerHTML = <span class=string>'Location obtained using '</span> + method;</span><br><span class=line></span><br><span class=line>    <span class=keyword>var</span> myOptions = &#123;</span><br><span class=line>      zoom: <span class=number>8</span>,</span><br><span class=line>      mapTypeId: google.maps.MapTypeId.ROADMAP</span><br><span class=line>    &#125;;</span><br><span class=line></span><br><span class=line>    map = <span class=keyword>new</span> google.maps.Map(<span class=built_in>document</span>.getElementById(<span class=string>'map'</span>), myOptions);</span><br><span class=line>    directionsDisplay = <span class=keyword>new</span> google.maps.DirectionsRenderer();</span><br><span class=line>    directionsDisplay.setMap(map);</span><br><span class=line>    directionsDisplay.setPanel(<span class=built_in>document</span>.getElementById(<span class=string>'route'</span>));</span><br><span class=line></span><br><span class=line>    <span class=keyword>var</span> request = &#123;</span><br><span class=line>      origin: coordinates.lat + <span class=string>','</span> + coordinates.lng,</span><br><span class=line>      destination: destinationName,</span><br><span class=line>      travelMode: google.maps.DirectionsTravelMode.DRIVING</span><br><span class=line>    &#125;;</span><br><span class=line>    directionsService = <span class=keyword>new</span> google.maps.DirectionsService();</span><br><span class=line>    directionsService.route(request, <span class=function><span class=keyword>function</span>(<span class=params>result, status</span>) </span>&#123;</span><br><span class=line>      <span class=keyword>if</span> (status === google.maps.DirectionsStatus.OK) &#123;</span><br><span class=line>        directionsDisplay.setDirections(result);</span><br><span class=line>      &#125;</span><br><span class=line>    &#125;);</span><br><span class=line>  &#125;</span><br><span class=line></span><br><span class=line>  <span class=built_in>window</span>.onload = <span class=function><span class=keyword>function</span>(<span class=params></span>) </span>&#123;</span><br><span class=line>    init();</span><br><span class=line>  &#125;;</span><br><span class=line>&#125;)();</span><br></pre></td></tr></table></figure><p>The code is mostly self-explanatory. We need to show the map, obtain the visitor’s position, ask for the directions and render them over the map. You can easily add more geolocation providers, and run them by priority changing they order in the providers array.</p><p>In my tests I have seen that I get <em>null</em> when checking <code>google.loader.ClientLocation</code>. It means that Google couldn’t retrieve a position to the IP that it has detected, so in this case the fallback can fail some times (maybe we should use a second fallback?).</p></div><hr/></article></div><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(n){})["catch"](function(n){})});</script><footer><section class=links><a href=https://twitter.com/jmperezperez>@jmperezperez</a> on Twitter · <a href=https://github.com/JMPerez>GitHub</a> · <a href=http://www.linkedin.com/in/jmperezperez>LinkedIn</a></section></footer></body></html>