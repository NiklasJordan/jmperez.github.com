<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta http-equiv=Accept-CH content="DPR, Viewport-Width, Width"><title>Playing with the Spotify Connect API - José M. Pérez</title><meta name=description content="The new Web API endpoints let you show what is playing in your Spotify account. It is easy to create views that update in real time."><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><link rel=author href="https://plus.google.com/107456024651797783420"/><link rel=alternate type=application/rss+xml title="Jose M. Perez" href=https://jmperezperez.com/feed.xml><meta name=twitter:card content=summary_large_image><meta name=twitter:url content="https://jmperezperez.com/spotify-connect-api/" property=og:url><meta name=twitter:title content="Playing with the Spotify Connect API - José M. Pérez" property=og:title><meta name=twitter:description content="The new Web API endpoints let you show what is playing in your Spotify account. It is easy to create views that update in real time." property=og:description><meta name=twitter:site content=@jmperezperez><meta property=og:image content=https://jmperezperez.com/assets/images/posts/spotify-connect-api-visualisation-artist.jpg><meta name=twitter:image content=https://jmperezperez.com/assets/images/posts/spotify-connect-api-visualisation-artist.jpg><meta property=fb:app_id content=1702266270006013><meta property=fb:pages content="1639848659664211"/><link rel=canonical href="https://jmperezperez.com/spotify-connect-api/"/><style>a,a:hover{color:#2a7cb2}.post::after,hr{display:block;clear:both}#page,.main-header,.videoWrapper{position:relative}.code,code,pre{letter-spacing:0}.code-wrap pre,pre{white-space:pre-wrap}.caption,.main-header,.me,.pagination,.pagination a,footer{text-align:center}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;border:none;font:inherit;margin:0;padding:0;vertical-align:baseline}button,input{background:0 0}body{background:#fff;color:#555;font-family:Georgia,Times;font-weight:300;font-style:normal;font-size:19px;line-height:1.725;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-text-size-adjust:100%}blockquote,em{font-style:italic}@media(max-width:800px){body{font-size:17px}}@media(max-width:600px){body{font-size:15px}}h1,h2,h3,h4,h5{color:#212121;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:600;font-size:1em;line-height:1.3;margin-bottom:1em}h2,h3,h4,h5{margin-top:2em}#menu a,.button{font-weight:400}.post ol,.post ul,amp-video,amp-vimeo,amp-youtube,iframe,p,video{margin:0 0 1em}.quote,blockquote,ol,ul{margin:0 0 15px}twitterwidget{margin-bottom:1em!important}a{font-weight:inherit;text-decoration:none;transition:color .15s ease-out,border-bottom-color .15s ease-out}p a{border-bottom:1px solid #eee}p a:hover{border-bottom-color:#212121}strong{font-weight:700}h2,h3{font-weight:400}h1{font-size:1.7em}h2{color:#444;font-size:1.6em}h3{color:#666;font-size:1.4em}h4{font-size:1.18em}h5{font-size:1em}a h1,a h2,a h3,a h4,a h5{transition:color .15s ease-out}a:hover h1,a:hover h2,a:hover h3,a:hover h4,a:hover h5{color:#3498db}blockquote{border-left:2px solid #ccc;padding-left:20px}ol,ul{padding-left:25px}ul{list-style:square}ol{list-style:decimal}hr{background:#eee;color:#eee;height:2px;margin:30px auto;width:50%}.main-header,.post,.post .svg-container object{width:100%}code,pre{color:#333;font-family:Courier,Menlo,Monaco;font-size:.8em;overflow-x:auto}.author,.main-header{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif}pre{padding:.8em 1em}code{margin:0}.post::after{content:''}.main-header{background-color:#005689;overflow:hidden;padding:1em}#menu{display:inline-block;margin:1px 0}#menu a{color:#fff;font-size:14px;margin-left:15px;padding:20px 10px;text-transform:uppercase}@media(max-width:500px){#menu a{margin-left:10px;padding:10px 5px}}#menu a:first-child{margin-left:0}#menu a[aria-current]{font-weight:700}#page{margin:0 auto;max-width:40em;padding:3em 2em}.videoWrapper{height:0;margin-bottom:1em;padding-bottom:56.25%;padding-top:25px}.videoWrapper amp-youtube,.videoWrapper iframe{height:100%;left:0;position:absolute;top:0;width:100%}.wrapper{border-top:2px solid #eee;padding:3em 0}.wrapper:first-child{border-top:none;padding-top:5%}.posts-list h2{margin-top:0}.post{display:block}.post div[itemprop=articleBody]>p:first-child{color:#333}.post li{margin-bottom:.5em}.post p img{border:1px solid #eee;display:block;max-width:100%}.post img+.caption{padding-top:5px}.post .svg-container{margin-bottom:5%;max-width:100%;text-align:center}video{height:auto;max-width:100%}.pagination a{min-width:30px;max-height:30px}footer{border-top:1px dashed #ddd;padding:2em}.timing-stats{font-size:.7em;padding:.35em}.button{background-color:#fff;border:1px solid #555;border-radius:20px;color:#555;display:inline-block;font-size:13px;line-height:10px;padding:10px 20px;transition:background-color .15s ease-out}.button:hover{background-color:#3498db;border-color:transparent;color:#fff}.button.inactive{background-color:#ccc;color:#fff}.search-goog input{border:2px solid #ddd;padding:10px}.search-goog input[type=submit]{background-color:#ddd;cursor:pointer}@media only screen and (max-width:768px){#page,.wrapper{margin:0;max-width:100%;padding:1.5em;width:100%}.wrapper{padding:10% 0}.wraper::after{clear:both;content:'';display:block}.post{margin:0 auto;max-width:640px}}.outscreen{height:1px;left:-1000px;overflow:hidden;position:absolute;top:auto;width:1px}.callout{border:1px solid #eee;border-left-color:#777;border-left-width:5px;border-radius:3px;font-size:90%;padding:20px;margin:20px 0}.author{font-size:.8em;margin-bottom:2em}.author .name{line-height:1.5;padding-top:.35em}.bd,.media{overflow:hidden;zoom:1}.media .img{float:left}.avatar-img{border-radius:100%;height:3.5em;margin-right:.5em;width:3.5em}.highlight{border:1px solid #eee;margin-bottom:1em;overflow-x:auto}.code{background:#fff;color:#333;display:block;overflow-x:auto}.code .comment,.code .meta{color:#969896}.code .emphasis,.code .quote,.code .string,.code .strong,.code .template-variable,.code .variable{color:#df5000}.code .keyword,.code .selector-tag,.code .type{color:#a71d5d}.code .attribute,.code .bullet,.code .literal,.code .symbol{color:#0086b3}.code .name,.code .section{color:#63a35c}.code .tag{color:#333}.code .attr,.code .selector-attr,.code .selector-class,.code .selector-id,.code .selector-pseudo,.code .title{color:#795da3}.code .addition{background-color:#eaffea;color:#55a532}.code .deletion{background-color:#ffecec;color:#bd2c00}.code .link{text-decoration:underline}.caption{display:block;font-size:.8em}.codepen-aspect-ratio>iframe{height:100%;position:absolute;width:100%}.twitter-tweet{margin-left:auto;margin-right:auto}.twitter-tweet::after{content:"";display:block;padding-bottom:20px;width:100%}.me{max-width:20em;margin:0 auto .5em}.me h1{margin-bottom:0}</style><link rel=amphtml href="/spotify-connect-api/amp/"><meta name=theme-color content=#005689><link rel=manifest href=/manifest.json></head><body><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-39254352-1","auto"),ga("send","pageview");</script><header class=main-header><nav id=menu><a href="/">Blog</a> <a href="/projects/">Projects</a> <a href="/talks/">Speaking</a> <a href="/about-me/">About</a></nav></header><div id=page><article class=wrapper><div class=post><header><script type=application/ld+json>{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Playing with the Spotify Connect API",
  
  "description": "The new Web API endpoints let you show what is playing in your Spotify account. It is easy to create views that update in real time.",
  
  "mainEntityOfPage":{
      "@type":"WebPage",
      "@id":"https://jmperezperez.com/spotify-connect-api/"
  },
  "datePublished": "2017-04-21T20:10:00.000Z",
  "dateModified": "2018-01-04T11:39:58.000Z",
  
  "image": {
    "@type": "ImageObject",
    "url": "https://jmperezperez.com/assets/images/posts/spotify-connect-api-visualisation-artist.jpg",
    "width" : "1200",
    "height" : "588"
  },
  
  "author": {
      "@type": "Person",
      "name": "Jose M. Perez",
      "url": "https://jmperezperez.com",
      "sameAs": [
        "http://www.linkedin.com/in/jmperezperez",
        "https://twitter.com/jmperezperez"
      ]
  },
  "publisher": {
      "@type": "Organization",
      "name": "Jose M. Perez's Blog"
      
      ,
      "logo": {
        "@type": "ImageObject",
        "url": "https://jmperezperez.com/assets/images/logo.png",
        "width": 600,
        "height": 60
      }
      
  }
}</script><div class="media author"><div class=img><a href="/about-me/"><img src=https://res.cloudinary.com/jmperez/image/upload/w_120,f_auto,c_scale/v1519156883/profile_ysrm5y.jpg class=avatar-img alt="" height=53 width=53 sizes=53px></a></div><div class=bd><address class=name itemprop=author itemscope itemtype=https://schema.org/Person><a href="/about-me/" itemprop=name>José M. Pérez</a></address><meta class=post-data itemprop=datePublished content=2017-04-21T20:10:00.000Z>April 21 2017</div></div><h1>Playing with the Spotify Connect API</h1></header><p>Spotify <a href="https://developer.spotify.com/news-stories/2017/04/10/new-endpoints-beta-web-api-connect/" target=_blank rel=noopener>released recently a set of endpoints</a> in beta to fetch information of what is playing and send playback commands. This allows for a wide range of integrations and I wanted to hack a bit with it.</p><p><img src=/assets/images/posts/spotify-connect.jpg alt="Spotify Connect"></p><a id=more></a><h4 id=What-is-Spotify-Connect><a href=#What-is-Spotify-Connect class=headerlink title="What is Spotify Connect"></a>What is Spotify Connect</h4><p><a href="https://www.spotify.com/connect/" target=_blank rel=noopener>Spotify Connect</a> is a way to transmit the playback from one device to another one without having to use a physical connection like a cable or bluetooth. You can send the music from your Spotify desktop client to a speaker, from the Spotify app on mobile to Spotify for PlayStation, from the Spotify web player to Chromecast… In short, you have controllers and devices that can play music.</p><p><img src=https://res.cloudinary.com/jmperez/image/upload/w_auto,f_auto,c_scale/v1510477863/spotify-web-player_k5sx2j.png sizes="(max-width: 768px) 100vw, 684px" alt="Spotify Web Player"> <small class=caption>Spotify’s Web Player (zoomed in). Clicking on the icon next to the volume we get a list of connected devices (FireTV, desktop client, speakers and the web player).</small></p><p>Your application can become a controller through the Web API endpoints, getting information about what is playing currently and from where, being able to transmit the playback to another connected device or interact with the current context (pausing, changing the volume, skipping, playing something else…).</p><h4 id=How-to-use-the-endpoints><a href=#How-to-use-the-endpoints class=headerlink title="How to use the endpoints"></a>How to use the endpoints</h4><p>Before using the Connect endpoints we need to obtain an access token on behalf of the user with certain permissions. There is more information about what scopes are needed in the documentation for each endpoint.</p><p>You don’t need to have a premium account to get the playback status, a free account is alright. You will do need a premium one if you want to <a href=https://developer.spotify.com/web-api/working-with-connect/#premium-only target=_blank rel=noopener>send commands to change the playback</a>.</p><p>A caveat at the moment is that the endpoints don’t support any kind of web socket connection nor long polling. Thus, if you want to get updates on the position of the current playing track or any other change in the context, you need to poll every few seconds.</p><h4 id=A-small-library-to-make-it-easier-to-use-the-endpoints><a href=#A-small-library-to-make-it-easier-to-use-the-endpoints class=headerlink title="A small library to make it easier to use the endpoints"></a>A small library to make it easier to use the endpoints</h4><p>The trickiest part of using the Spotify Web API is to implement the authorization flow. <a href="https://developer.spotify.com/web-api/authorization-guide/" target=_blank rel=noopener>The Authorization Guide</a> does a good job explaining it, but I thought I could do something so developers wouldn’t need to worry about setting up the whole flow, hiding away the authentication and just getting.</p><p>That’s why I have created <a href=https://github.com/JMPerez/spotify-player target=_blank rel=noopener>spotify-player</a>. It’s both a server and a library that you use to communicate with it. To use it, you just need to include a script, call login() and subscribe to the updates:</p><figure class="highlight html"><table><tr><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>script</span> <span class=attr>src</span>=<span class=string>"https://spotify-player.herokuapp.com/spotify-player.js"</span>&gt;</span><span class=undefined></span><span class=tag>&lt;/<span class=name>script</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class=code><pre><span class=line><span class=keyword>var</span> spotifyPlayer = <span class=keyword>new</span> SpotifyPlayer();</span><br><span class=line></span><br><span class=line>spotifyPlayer.on(<span class=string>'update'</span>, response =&gt; &#123;</span><br><span class=line>  <span class=comment>// render the track received</span></span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line>spotifyPlayer.on(<span class=string>'login'</span>, user =&gt; &#123;</span><br><span class=line>  <span class=keyword>if</span> (user === <span class=literal>null</span>) &#123;</span><br><span class=line>    <span class=comment>// no user</span></span><br><span class=line>  &#125; <span class=keyword>else</span> &#123;</span><br><span class=line>    <span class=comment>// say hello to the user, and tell them to play something!</span></span><br><span class=line>  &#125;</span><br><span class=line>&#125;);</span><br><span class=line></span><br><span class=line>spotifyPlayer.init();</span><br><span class=line></span><br><span class=line>spotifyPlayer.login();</span><br></pre></td></tr></table></figure><p>You can forget about <a href=https://developer.spotify.com/my-applications target=_blank rel=noopener>setting up a Spotify application</a> and a server, carrying out the token exchange, token refresh, and persisting the current user, <strong>so you can focus on the fun part</strong>.</p><p>Other methods include a function to make calls to other Spotify endpoints reusing the same access token, so you can fetch other data that can help you creating a more complete visualisation.</p><p>Let’s have a look at <a href=https://codepen.io/jmperez/full/MmwObE target=_blank rel=noopener>this pen</a> as an example of a basic visualisation:</p><iframe id=cp_embed_MmwObE src="//codepen.io/jmperez/embed/MmwObE?height=389&theme-id=0&slug-hash=MmwObE&default-tab=result" scrolling=no frameborder=no height=389 allowtransparency=true allowfullscreen=true class=cp_embed_iframe data-amp-width=100% style="width: 100%; overflow: hidden"></iframe><p>And in case you can’t try it or don’t have a Spotify account this is pretty much what it looks like:</p><p><img src=https://res.cloudinary.com/jmperez/image/upload/w_auto,f_auto,c_scale/v1510476629/spotify-connect-api-visualisation-example_hwu7uw.jpg sizes="(max-width: 768px) 100vw, 684px" alt="Example of a visualisation of Spotify"> <small class=caption>See <a href=https://codepen.io/jmperez/full/MmwObE target=_blank rel=noopener>the Pen on Codepen</a></small></p><p>I have kept the example very basic since the point is understanding the usage of the library. If you are into performance and UX you’ll see there is room for improvement, but as a front-end developer I know an example can get out of hand very easily when adding things.</p><p>I encourage you to fork it and start making your own visualisation. And once you do it, ping me so I include it in <a href=https://codepen.io/collection/AyVBYB target=_blank rel=noopener>this Codepen collection</a>.</p><h3 id=Possible-applications><a href=#Possible-applications class=headerlink title="Possible applications"></a>Possible applications</h3><p><em>Disclaimer: This is a list of some use cases. You still need to comply with <a href="https://developer.spotify.com/developer-terms-of-use/" target=_blank rel=noopener>Spotify’s terms of use</a> when implementing an application that uses Spotify’sWeb API. This might mean adding certain messaging and link to the song in Spotify.</em></p><h4 id=Dynamic-visualisations><a href=#Dynamic-visualisations class=headerlink title="Dynamic visualisations"></a>Dynamic visualisations</h4><p>You could combine the playback position with <a href="https://developer.spotify.com/web-api/get-audio-analysis/" target=_blank rel=noopener>the audio analysis of the track</a> to generate dynamic visualisations using loudness, tempo, key, timbre or pitch of the segments that compose the track. You can also use <a href="https://developer.spotify.com/web-api/get-audio-features/" target=_blank rel=noopener>the endpoint to fetch audio features of a track</a>, which gives you high level information about characteristics of the song.</p><div class=videoWrapper><iframe width=720 height=405 src=https://www.youtube.com/embed/KO9huh-Y03g frameborder=0 allowfullscreen></iframe></div><p><small class=caption>See <a href=https://codepen.io/jmperez/full/GmJOMJ target=_blank rel=noopener>the Pen on Codepen</a> and <a href=https://github.com/possan/webgl-spotify-connect-now-playing-screen-example target=_blank rel=noopener>Possan’s original visualisation on GitHub</a></small></p><h4 id=Now-playing-view><a href=#Now-playing-view class=headerlink title="Now playing view"></a>Now playing view</h4><p>Are you a coffee-shop owner and people always wonder what song is playing? You could have a TV showing a branded now playing view. You could even have a widget on your website, or a script posting to a social network what is currently playing so your customers know. Or a small browser extension showing what is playing and/or <a href=https://developer.chrome.com/extensions/notifications target=_blank rel=noopener>showing desktop notifications</a> when the track changes.</p><p><img src=https://res.cloudinary.com/jmperez/image/upload/w_auto,f_auto,c_scale/v1510477615/spotify-connect-api-visualisation-notification_mgxad5.jpg sizes="(max-width: 768px) 100vw, 684px" alt="Spotify Visualisation showing Web Notifications when the track changes"> <small class=caption>See <a href=https://codepen.io/jmperez/full/VbvPbR target=_blank rel=noopener>the Pen on Codepen</a>. When the track changes the browser shows a Web Notification.</small></p><p>Or if you are at home hosting a dinner or party, show on the TV or computer what is playing.</p><p>You can combine other Spotify Web API endpoints too. Eg you could <a href="https://developer.spotify.com/web-api/get-artist/" target=_blank rel=noopener>fetch the artists info</a> to show the artist profile image in the background:</p><p><img src=https://res.cloudinary.com/jmperez/image/upload/w_auto,f_auto,c_scale/v1510477674/spotify-connect-api-visualisation-artist_ebk7cc.jpg sizes="(max-width: 768px) 100vw, 684px" alt="Spotify Visualisation showing the artist profile image in the background"> <small class=caption>See <a href=https://codepen.io/jmperez/full/YVXEaz target=_blank rel=noopener>the Pen on Codepen</a>. A simple visualisation of what’s playing in Spotify rendering the artist profile image as the background.</small></p><p>You could use an API like <a href="https://developer.musixmatch.com/" target=_blank rel=noopener>Musixmatch</a>’s and create an app or a website showing the lyrics for the current song, synchronised with the playback position.</p><p>And your imagination is the limit. Use <a href=https://genius.com/developers target=_blank rel=noopener>Genius’ API</a> to get <a href=https://docs.genius.com/#annotations-h2 target=_blank rel=noopener>annotations</a> about a song, or search for trivia and more info about the song or artist using <a href=https://www.mediawiki.org/wiki/API:Main_page target=_blank rel=noopener>Wikipedia’s API</a>. And if you don’t want to miss what’s happening in the world, implement a news ticker in your view using <a href="https://newsapi.org/" target=_blank rel=noopener>News API</a>.</p><div class=videoWrapper><iframe width=720 height=405 src=https://www.youtube.com/embed/q4I3ymLgewE frameborder=0 allowfullscreen></iframe></div><p><small class=caption>See <a href=https://codepen.io/jmperez/full/OmVKOO target=_blank rel=noopener>the Pen on Codepen</a><small class=caption></small></small></p><h4 id=MVP><a href=#MVP class=headerlink title=MVP></a>MVP</h4><p><a href=https://github.com/JMPerez/spotify-player target=_blank rel=noopener>The library</a> is really small and it only supports <em>reading</em> the playback state and not send commands. Let’s call it an MVP. I might work on adding more features in the future.</p></div><hr/></article></div><script>"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(n){})["catch"](function(n){})});</script><footer><section class=links><a href=https://twitter.com/jmperezperez>@jmperezperez</a> on Twitter · <a href=https://github.com/JMPerez>GitHub</a> · <a href=http://www.linkedin.com/in/jmperezperez>LinkedIn</a></section><div class=timing-stats></div></footer><script>window.addEventListener('load', () => {
     setTimeout(() => {
      var t = window.performance && performance.timing;
      function round2(num) { return Math.round(num * 100) / 100; }
      if (t) {
          var timingStats = document.querySelector('.timing-stats');
          var loadTime = (t.loadEventEnd - t.navigationStart) / 1000;
          var timingStatsHTML = 'This page loaded in ' + round2(loadTime) + ' seconds. ';
          var performanceEntries = performance.getEntriesByType('paint');
          performanceEntries.forEach(function(performanceEntry, i, entries) {
            let name = performanceEntry.name;
            if (name === 'first-paint') {
              name = '<abbr title=' + name + '>FP</abbr>';
            } else if (name === 'first-contentful-paint') {
              name = '<abbr title=' + name + '>FCP</abbr>';
            }
            timingStatsHTML += name + ' was ' + round2(performanceEntry.startTime / 1000) + ' seconds. ';
          });
          timingStats.innerHTML = timingStatsHTML;
      }
    }, 0);
   });</script></body></html>